const pool = require('../config/db');

const getAllVulnerabilities = async () => {
    const result = await pool.query('SELECT * FROM vulnerabilities ORDER BY reported_at DESC');
    return result.rows;
};

const getVulnerabilityById = async (id) => {
    const result = await pool.query('SELECT * FROM vulnerabilities WHERE id = $1', [id]);
    return result.rows[0];
};

const addVulnerability = async (name, description, severity, status) => {
    const result = await pool.query(
        'INSERT INTO vulnerabilities (name, description, severity, status) VALUES ($1, $2, $3, $4) RETURNING *',
        [name, description, severity, status]
    );
    return result.rows[0];
};

const updateVulnerability = async (id, name, description, severity, status) => {
    const result = await pool.query(
        'UPDATE vulnerabilities SET name = $1, description = $2, severity = $3, status = $4 WHERE id = $5 RETURNING *',
        [name, description, severity, status, id]
    );
    return result.rows[0];
};

const deleteVulnerability = async (id) => {
    const result = await pool.query('DELETE FROM vulnerabilities WHERE id = $1 RETURNING *', [id]);
    return result.rows[0];
};

module.exports = {
    getAllVulnerabilities,
    getVulnerabilityById,
    addVulnerability,
    updateVulnerability,
    deleteVulnerability,
};
